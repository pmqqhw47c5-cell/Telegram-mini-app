<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Shop Du Lev ‚Äì Catalogue</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <style>
    * {
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }

    body {
      margin: 0;
      padding: 20px 10px 90px;
      background: radial-gradient(circle at top, #1b0033 0, #050012 60%, #020008 100%);
      font-family: -apple-system, system-ui, sans-serif;
      color: #fff;
      text-align: center;
    }

    /* Logo rond SL */
    .logo {
      width: 90px;
      height: 90px;
      border-radius: 50%;
      margin: 0 auto 24px;
      background: radial-gradient(circle at 30% 0, #00ffd9, #0080ff, #001233);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 30px;
      font-weight: 700;
      box-shadow: 0 0 30px #00ffd980;
    }

    /* Boutons du haut */
    .top-buttons {
      width: 100%;
      max-width: 480px;
      margin: 0 auto 20px;
    }

    .top-btn {
      width: 100%;
      margin: 8px 0;
      padding: 14px 16px;
      font-size: 18px;
      border-radius: 14px;
      border: none;
      background: rgba(120, 0, 255, 0.8);
      color: #fff;
      font-weight: 600;
      text-shadow: 0 0 6px #e9d0ff;
      box-shadow: 0 0 18px #9b3dff, 0 0 8px #2b004b inset;
      cursor: pointer;
    }

    .top-btn:active {
      transform: translateY(1px) scale(0.99);
      box-shadow: 0 0 8px #9b3dff;
    }

    /* PRODUITS */
    #catalogue {
      width: 100%;
      max-width: 480px;
      margin: 0 auto;
    }

    .product {
      width: 100%;
      margin: 18px auto;
      padding: 18px 14px 16px;
      border-radius: 20px;
      background: rgba(55, 0, 90, 0.85);
      box-shadow: 0 0 26px #7e22ce, 0 0 40px #2b004b inset;
      position: relative;
      overflow: hidden;
    }

    .product::before {
      content: "";
      position: absolute;
      inset: -50%;
      background: radial-gradient(circle at top, #ff7af5, transparent 60%),
                  radial-gradient(circle at bottom, #00ffd9, transparent 55%);
      opacity: 0.25;
      pointer-events: none;
    }

    .product-inner {
      position: relative;
      z-index: 1;
    }

    .fake-image {
      width: 100%;
      height: 130px;
      border-radius: 16px;
      margin-bottom: 14px;
      background: radial-gradient(circle at 20% 0, #ffb347, transparent 60%),
                  linear-gradient(120deg, #ff7a18, #0b0020 65%);
      box-shadow: 0 0 20px #f97316aa;
    }

    .product-name {
      font-size: 20px;
      font-weight: 700;
      margin-bottom: 6px;
    }

    .product-desc {
      font-size: 14px;
      color: #d5cfff;
      margin-bottom: 10px;
    }

    .price {
      font-size: 20px;
      font-weight: 700;
      color: #22d3ee;
      text-shadow: 0 0 8px #22d3ee;
    }

    .order-btn {
      margin-top: 12px;
      padding: 10px 24px;
      border-radius: 999px;
      border: none;
      background: linear-gradient(135deg, #22d3ee, #a855f7);
      color: #020617;
      font-size: 16px;
      font-weight: 700;
      box-shadow: 0 0 16px #22d3ee;
      cursor: pointer;
    }

    .order-btn:active {
      transform: translateY(1px) scale(0.98);
      box-shadow: 0 0 6px #22d3ee;
    }

    /* BARRE PANIER EN BAS */
    #cart-bar {
      position: fixed;
      left: 0;
      right: 0;
      bottom: 0;
      padding: 10px 16px 14px;
      background: radial-gradient(circle at top, #7c3aed, #020012 80%);
      box-shadow: 0 -4px 22px #4c1d95;
      display: flex;
      justify-content: space-between;
      align-items: center;
      max-width: 520px;
      margin: 0 auto;
      border-radius: 18px 18px 0 0;
      cursor: pointer;
      z-index: 30;
    }

    #cart-bar span:first-child {
      font-weight: 600;
      font-size: 15px;
    }

    .cart-bar-count {
      font-size: 14px;
      color: #c4b5fd;
    }

    /* OVERLAY G√âN√âRIQUE */
    .overlay {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.78);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 40;
      padding: 20px 10px;
    }

    .overlay.show {
      display: flex;
    }

    .modal {
      width: 100%;
      max-width: 480px;
      background: #0b0015;
      border-radius: 24px;
      padding: 18px 16px 20px;
      border: 2px solid #a855f7;
      box-shadow: 0 0 26px #a855f7, 0 0 50px #22d3ee55;
      text-align: left;
    }

    .modal-header {
      font-size: 18px;
      font-weight: 700;
      margin-bottom: 12px;
    }

    .modal-body {
      font-size: 15px;
      margin-bottom: 14px;
    }

    .modal-actions {
      margin-top: 18px;
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }

    .btn-primary,
    .btn-secondary {
      flex: 1;
      padding: 10px 14px;
      border-radius: 999px;
      border: none;
      font-size: 15px;
      font-weight: 600;
      cursor: pointer;
    }

    .btn-primary {
      background: linear-gradient(135deg, #22d3ee, #a855f7);
      color: #020617;
      box-shadow: 0 0 14px #22d3ee;
    }

    .btn-secondary {
      background: #111827;
      color: #e5e7eb;
      border: 1px solid #4b5563;
    }

    .btn-primary:active,
    .btn-secondary:active {
      transform: translateY(1px) scale(0.98);
    }

    /* POPUP R√âSEAUX */
    #reseaux-image {
      width: 100%;
      border-radius: 18px;
      display: block;
    }

    /* MODAL COMMANDE */
    #commande-qty {
      width: 90px;
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid #4b5563;
      background: #020617;
      color: #e5e7eb;
      font-size: 15px;
      text-align: center;
      margin-top: 4px;
    }

    /* PANIER LISTE */
    #cart-list {
      max-height: 260px;
      overflow-y: auto;
      margin-bottom: 10px;
      padding-right: 4px;
    }

    .cart-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
      gap: 8px;
      font-size: 14px;
    }

    .cart-item-name {
      font-weight: 600;
      margin-bottom: 2px;
    }

    .cart-item-qty {
      font-size: 13px;
      color: #a5b4fc;
      margin: 0 6px;
    }

    .cart-item-price {
      font-weight: 600;
      color: #22d3ee;
    }

    .qty-btn {
      width: 26px;
      height: 26px;
      border-radius: 999px;
      border: none;
      background: #111827;
      color: #e5e7eb;
      font-size: 18px;
      line-height: 1;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
    }

    .qty-btn:active {
      transform: translateY(1px) scale(0.95);
    }

    .cart-row-left {
      display: flex;
      flex-direction: column;
      align-items: flex-start;
    }

    .cart-controls {
      display: flex;
      align-items: center;
      margin-top: 2px;
    }

    #empty-cart-msg {
      font-size: 14px;
      color: #9ca3af;
      margin-bottom: 10px;
    }

    #cart-total {
      font-size: 15px;
      font-weight: 600;
      margin-top: 4px;
      margin-bottom: 12px;
    }

    /* PAIEMENT */
    .pay-section {
      border-top: 1px solid #4b5563;
      padding-top: 10px;
      margin-top: 6px;
    }

    .pay-title {
      font-size: 14px;
      font-weight: 600;
      margin-bottom: 6px;
    }

    .pay-options {
      font-size: 13px;
      display: flex;
      flex-direction: column;
      gap: 4px;
      margin-bottom: 8px;
    }

    .pay-options label {
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .pay-note {
      font-size: 11px;
      color: #9ca3af;
      margin-top: 2px;
    }

    @media (min-width: 520px) {
      body {
        padding-bottom: 110px;
      }
    }
  </style>
</head>

<body>

  <div class="logo">SL</div>

  <div class="top-buttons">
    <button class="top-btn" id="btn-miniapp">Mini App Du Lev</button>
    <button class="top-btn" id="btn-reseaux">R√©seaux Sociaux</button>
    <button class="top-btn" id="btn-livraison">Livraison üöö</button>
  </div>

  <!-- CATALOGUE -->
  <div id="catalogue">

    <div class="product" data-name="üéß √âcouteurs Bluetooth" data-price="34.99">
      <div class="product-inner">
        <div class="fake-image"></div>
        <div class="product-name">üéß √âcouteurs Bluetooth</div>
        <div class="product-desc">Autonomie, basses, r√©duction de bruit.</div>
        <div class="price">34,99 ‚Ç¨</div>
        <button class="order-btn">Commander</button>
      </div>
    </div>

    <div class="product" data-name="üîã Powerbank 20 000 mAh" data-price="29.99">
      <div class="product-inner">
        <div class="fake-image"></div>
        <div class="product-name">üîã Powerbank 20 000 mAh</div>
        <div class="product-desc">Recharge rapide USB-C & USB.</div>
        <div class="price">29,99 ‚Ç¨</div>
        <button class="order-btn">Commander</button>
      </div>
    </div>

    <div class="product" data-name="üçì Tiramisu Fraise Framboise" data-price="5.50">
      <div class="product-inner">
        <div class="fake-image"></div>
        <div class="product-name">üçì Tiramisu Fraise Framboise</div>
        <div class="product-desc">Frais & fait maison, √©dition √©t√©.</div>
        <div class="price">5,50 ‚Ç¨</div>
        <button class="order-btn">Commander</button>
      </div>
    </div>

    <div class="product" data-name="üç´ Tiramisu Or√©o" data-price="5.50">
      <div class="product-inner">
        <div class="fake-image"></div>
        <div class="product-name">üç´ Tiramisu Or√©o</div>
        <div class="product-desc">Cr√®me onctueuse & morceaux d‚ÄôOr√©o.</div>
        <div class="price">5,50 ‚Ç¨</div>
        <button class="order-btn">Commander</button>
      </div>
    </div>

    <div class="product" data-name="üì¶ Pack Trio Tiramisu" data-price="14.99">
      <div class="product-inner">
        <div class="fake-image"></div>
        <div class="product-name">üì¶ Pack Trio Tiramisu</div>
        <div class="product-desc">1 Caf√© Cacao + 1 Fraise Framboise + 1 Passion.</div>
        <div class="price">14,99 ‚Ç¨</div>
        <button class="order-btn">Commander</button>
      </div>
    </div>
  </div>

  <!-- BARRE PANIER -->
  <div id="cart-bar">
    <span>üõí Panier vide</span>
    <span class="cart-bar-count">0 article ‚Äì 0,00 ‚Ç¨</span>
  </div>

  <!-- POPUP R√âSEAUX -->
  <div class="overlay" id="overlay-reseaux">
    <div class="modal">
      <div class="modal-header">R√©seaux sociaux</div>
      <div class="modal-body">
        <!-- ton image dans le repo -->
        <img id="reseaux-image" src="reseaux-test.png.PNG" alt="R√©seaux sociaux Shop Du Lev" />
      </div>
      <div class="modal-actions">
        <button class="btn-primary" id="close-reseaux">Fermer</button>
      </div>
    </div>
  </div>

  <!-- POPUP CHOIX QUANTIT√â -->
  <div class="overlay" id="overlay-commande">
    <div class="modal">
      <div class="modal-header" id="commande-title">Ajouter au panier</div>
      <div class="modal-body">
        <div id="commande-body"></div>
        <label>
          Quantit√© :
          <input type="number" id="commande-qty" min="1" step="1" value="1" />
        </label>
      </div>
      <div class="modal-actions">
        <button class="btn-secondary" id="btn-cancel-commande">Annuler</button>
        <button class="btn-primary" id="btn-add-cart">Ajouter au panier</button>
      </div>
    </div>
  </div>

  <!-- POPUP PANIER -->
  <div class="overlay" id="overlay-panier">
    <div class="modal">
      <div class="modal-header">Votre panier</div>
      <div class="modal-body">
        <div id="empty-cart-msg">Aucun article pour le moment.</div>
        <div id="cart-list"></div>
        <div id="cart-total"></div>

        <div class="pay-section">
          <div class="pay-title">Moyen de paiement</div>
          <div class="pay-options">
            <label>
              <input type="radio" name="pay-method" value="cash" checked />
              Esp√®ces √† la livraison
            </label>
            <label>
              <input type="radio" name="pay-method" value="lydia" />
              Lydia / virement instantan√©
            </label>
            <label>
              <input type="radio" name="pay-method" value="paypal" />
              PayPal
            </label>
          </div>
          <div class="pay-note">
            Le bouton ‚ÄúValider la commande‚Äù enverra le r√©cap au bot (via Telegram Mini App).  
            Tu pourras ensuite g√©rer le paiement directement avec le client.
          </div>
        </div>
      </div>

      <div class="modal-actions">
        <button class="btn-secondary" id="btn-close-panier">Fermer</button>
        <button class="btn-primary" id="btn-submit-order">Valider la commande</button>
      </div>
    </div>
  </div>

  <script>
    /* --- BOUTONS DU HAUT --- */
    const btnMiniApp = document.getElementById("btn-miniapp");
    const btnReseaux = document.getElementById("btn-reseaux");
    const btnLivraison = document.getElementById("btn-livraison");
    const catalogue = document.getElementById("catalogue");

    btnMiniApp.addEventListener("click", () => {
      catalogue.scrollIntoView({ behavior: "smooth" });
    });

    btnLivraison.addEventListener("click", () => {
      alert(
        "Livraison Shop Du Lev üöö\n\n" +
          "‚Ä¢ Besan√ßon & alentours\n" +
          "‚Ä¢ Commande via la mini-app ou le bot\n" +
          "‚Ä¢ Paiement : esp√®ces / Lydia / PayPal."
      );
    });

    /* --- POPUP RESEAUX --- */
    const overlayReseaux = document.getElementById("overlay-reseaux");
    const closeReseaux = document.getElementById("close-reseaux");

    btnReseaux.addEventListener("click", () => {
      overlayReseaux.classList.add("show");
    });

    closeReseaux.addEventListener("click", () => {
      overlayReseaux.classList.remove("show");
    });

    overlayReseaux.addEventListener("click", (e) => {
      if (e.target === overlayReseaux) {
        overlayReseaux.classList.remove("show");
      }
    });

    /* --- PANIER --- */
    const cartBar = document.getElementById("cart-bar");
    const overlayCommande = document.getElementById("overlay-commande");
    const overlayPanier = document.getElementById("overlay-panier");

    const commandeTitle = document.getElementById("commande-title");
    const commandeBody = document.getElementById("commande-body");
    const commandeQty = document.getElementById("commande-qty");
    const btnAddCart = document.getElementById("btn-add-cart");
    const btnCancelCommande = document.getElementById("btn-cancel-commande");

    const cartList = document.getElementById("cart-list");
    const cartTotal = document.getElementById("cart-total");
    const emptyCartMsg = document.getElementById("empty-cart-msg");
    const btnClosePanier = document.getElementById("btn-close-panier");
    const btnSubmitOrder = document.getElementById("btn-submit-order");

    let cart = [];
    let currentProduct = null;

    // Associer les boutons commander
    document.querySelectorAll(".product").forEach((productEl) => {
      const btnOrder = productEl.querySelector(".order-btn");
      const name = productEl.dataset.name;
      const price = parseFloat(productEl.dataset.price);

      btnOrder.addEventListener("click", () => {
        openCommandeModal(name, price);
      });
    });

    function formatPrice(value) {
      return value.toFixed(2).replace(".", ",") + " ‚Ç¨";
    }

    function openCommandeModal(name, price) {
      currentProduct = { name, price };
      commandeTitle.textContent = "Ajouter au panier";
      commandeBody.textContent = name + " ‚Äì " + formatPrice(price);
      commandeQty.value = "1";
      overlayCommande.classList.add("show");
      commandeQty.focus();
    }

    function closeCommandeModal() {
      overlayCommande.classList.remove("show");
      currentProduct = null;
    }

    btnCancelCommande.addEventListener("click", closeCommandeModal);

    overlayCommande.addEventListener("click", (e) => {
      if (e.target === overlayCommande) {
        closeCommandeModal();
      }
    });

    btnAddCart.addEventListener("click", () => {
      if (!currentProduct) return;

      let qty = parseInt(commandeQty.value, 10);
      if (isNaN(qty) || qty <= 0) {
        alert("Merci d‚Äôentrer une quantit√© valide (au moins 1).");
        return;
      }

      const existing = cart.find((item) => item.name === currentProduct.name);
      if (existing) {
        existing.qty += qty;
      } else {
        cart.push({
          name: currentProduct.name,
          price: currentProduct.price,
          qty: qty,
        });
      }

      updateCartBar();
      closeCommandeModal();
    });

    function updateCartBar() {
      let totalQty = 0;
      let totalPrice = 0;

      cart.forEach((item) => {
        totalQty += item.qty;
        totalPrice += item.qty * item.price;
      });

      const labelSpan = cartBar.querySelector("span:first-child");
      const countSpan = cartBar.querySelector(".cart-bar-count");

      if (totalQty === 0) {
        labelSpan.textContent = "üõí Panier vide";
        countSpan.textContent = "0 article ‚Äì 0,00 ‚Ç¨";
      } else {
        labelSpan.textContent = "üõí Voir le panier";
        const word = totalQty > 1 ? "articles" : "article";
        countSpan.textContent =
          totalQty + " " + word + " ‚Äì " + formatPrice(totalPrice);
      }
    }

    // Ouvrir / fermer le panier
    cartBar.addEventListener("click", () => {
      openCartModal();
    });

    function openCartModal() {
      renderCart();
      overlayPanier.classList.add("show");
    }

    function closeCartModal() {
      overlayPanier.classList.remove("show");
    }

    btnClosePanier.addEventListener("click", closeCartModal);

    overlayPanier.addEventListener("click", (e) => {
      if (e.target === overlayPanier) {
        closeCartModal();
      }
    });

    // Afficher le contenu du panier avec +/-
    function renderCart() {
      cartList.innerHTML = "";
      let totalQty = 0;
      let totalPrice = 0;

      if (cart.length === 0) {
        emptyCartMsg.style.display = "block";
        cartTotal.textContent = "";
        return;
      }

      emptyCartMsg.style.display = "none";

      cart.forEach((item, index) => {
        totalQty += item.qty;
        totalPrice += item.qty * item.price;

        const row = document.createElement("div");
        row.className = "cart-item";
        row.dataset.index = index;

        const left = document.createElement("div");
        left.className = "cart-row-left";

        const nameSpan = document.createElement("div");
        nameSpan.className = "cart-item-name";
        nameSpan.textContent = item.name;

        const controls = document.createElement("div");
        controls.className = "cart-controls";

        const minusBtn = document.createElement("button");
        minusBtn.textContent = "‚àí";
        minusBtn.className = "qty-btn qty-minus";

        const qtySpan = document.createElement("span");
        qtySpan.className = "cart-item-qty";
        qtySpan.textContent = "x" + item.qty;

        const plusBtn = document.createElement("button");
        plusBtn.textContent = "+";
        plusBtn.className = "qty-btn qty-plus";

        controls.appendChild(minusBtn);
        controls.appendChild(qtySpan);
        controls.appendChild(plusBtn);

        left.appendChild(nameSpan);
        left.appendChild(controls);

        const right = document.createElement("div");
        right.className = "cart-item-price";
        right.textContent = formatPrice(item.qty * item.price);

        row.appendChild(left);
        row.appendChild(right);

        cartList.appendChild(row);
      });

      cartTotal.textContent =
        "Total (" +
        totalQty +
        (totalQty > 1 ? " articles" : " article") +
        ") : " +
        formatPrice(totalPrice);
    }

    // G√©rer les boutons +/- avec d√©l√©gation
    cartList.addEventListener("click", (e) => {
      const isMinus = e.target.classList.contains("qty-minus");
      const isPlus = e.target.classList.contains("qty-plus");
      if (!isMinus && !isPlus) return;

      const row = e.target.closest(".cart-item");
      if (!row) return;

      const index = parseInt(row.dataset.index, 10);
      if (isNaN(index)) return;

      const item = cart[index];
      if (!item) return;

      if (isPlus) {
        item.qty += 1;
      } else if (isMinus) {
        item.qty -= 1;
        if (item.qty <= 0) {
          cart.splice(index, 1);
        }
      }

      updateCartBar();
      renderCart();
    });

    // Validation / envoi de commande
    btnSubmitOrder.addEventListener("click", () => {
      if (cart.length === 0) {
        alert("Ton panier est vide.");
        return;
      }

      const payInput = document.querySelector('input[name="pay-method"]:checked');
      const payMethod = payInput ? payInput.value : "cash";

      let totalQty = 0;
      let totalPrice = 0;
      let lines = [];

      cart.forEach((item) => {
        totalQty += item.qty;
        totalPrice += item.qty * item.price;
        lines.push("‚Ä¢ " + item.name + " x" + item.qty + " = " + formatPrice(item.qty * item.price));
      });

      let payText = "";
      if (payMethod === "cash") payText = "Esp√®ces √† la livraison";
      if (payMethod === "lydia") payText = "Lydia / virement instantan√©";
      if (payMethod === "paypal") payText = "PayPal";

      const summary =
        "üõí Nouvelle commande Shop Du Lev\n\n" +
        lines.join("\n") +
        "\n\nTotal : " +
        formatPrice(totalPrice) +
        "\nArticles : " +
        totalQty +
        "\nPaiement : " +
        payText;

      // Envoi au bot via Telegram WebApp si disponible
      try {
        if (window.Telegram && window.Telegram.WebApp && window.Telegram.WebApp.sendData) {
          window.Telegram.WebApp.sendData(summary);
          alert("Commande envoy√©e au bot ‚úÖ");
        } else {
          // Fallback si on est juste dans le navigateur
          alert(summary);
        }
      } catch (err) {
        console.error(err);
        alert("Erreur lors de l‚Äôenvoi de la commande.");
      }

      closeCartModal();
    });
  </script>
</body>
</html>
