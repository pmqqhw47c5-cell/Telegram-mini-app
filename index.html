<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Mini App Du Lev</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <style>
    :root {
      --bg: #f3f6f1;
      --bg-card: #ffffff;
      --bg-menu: #e5f3ea;
      --bg-product: #f8fbf6;
      --accent: #3aa46b;
      --accent-dark: #267754;
      --accent-soft: rgba(58, 164, 107, 0.1);
      --text-main: #111827;
      --text-muted: #6b7280;
      --shadow-soft: 0 18px 40px rgba(15, 23, 42, 0.16);
      --radius-xl: 22px;
      --radius-lg: 18px;
      --radius-pill: 999px;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    html,
    body {
      height: 100%;
    }

    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text",
        sans-serif;
      background: var(--bg);
      color: var(--text-main);
      display: flex;
      justify-content: center;
      align-items: stretch;
    }

    .app {
      position: relative;
      width: 100%;
      max-width: 480px;
      margin: 0 auto;
      padding: 14px;
      display: flex;
      flex-direction: column;
      gap: 12px;
      overflow: hidden;
    }

    /* ==== DÃ©cor arbres / nature ==== */
    .bg-tree {
      position: absolute;
      inset: -80px -40px auto;
      z-index: -1;
      pointer-events: none;
    }

    .tree-left,
    .tree-right {
      position: absolute;
      width: 160px;
      height: 260px;
      background: radial-gradient(circle at 30% 0, #c8f3d8 0, #6fcf97 35%, #2f855a 70%, #14532d 100%);
      border-radius: 100px 100px 40px 40px;
      filter: blur(0.3px);
      opacity: 0.9;
    }

    .tree-left {
      left: -40px;
      top: 10px;
    }

    .tree-right {
      right: -55px;
      top: -10px;
      transform: scale(0.9);
    }

    .tree-trunk {
      position: absolute;
      width: 26px;
      height: 80px;
      background: linear-gradient(to bottom, #b45309, #78350f);
      border-radius: 40px;
      bottom: -20px;
      left: 50%;
      transform: translateX(-50%);
      filter: blur(0.2px);
    }

    /* === HEADER === */
    .top-bar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 2px;
    }

    .close-btn {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 6px 10px;
      border-radius: var(--radius-pill);
      border: none;
      background: rgba(31, 41, 55, 0.06);
      font-size: 0.82rem;
      color: #111827;
    }

    .close-btn span:first-child {
      display: inline-flex;
      width: 22px;
      height: 22px;
      border-radius: 999px;
      align-items: center;
      justify-content: center;
      background: rgba(15, 23, 42, 0.08);
    }

    .top-right {
      display: flex;
      align-items: center;
      gap: 4px;
      opacity: 0.7;
      font-size: 0.8rem;
    }

    /* HEADER CARD (avatar + nom) */
    .header-card {
      position: relative;
      border-radius: var(--radius-xl);
      background: var(--bg-card);
      box-shadow: var(--shadow-soft);
      padding: 16px 14px 14px;
      display: flex;
      align-items: center;
      gap: 12px;
      overflow: hidden;
    }

    .header-card::before {
      content: "";
      position: absolute;
      inset: -20px;
      background: radial-gradient(circle at 0 0, rgba(165, 243, 192, 0.45), transparent 55%);
      opacity: 0.9;
      pointer-events: none;
    }

    .avatar {
      position: relative;
      z-index: 1;
      width: 56px;
      height: 56px;
      border-radius: 999px;
      background: radial-gradient(circle at 30% 0, #efffef 0, #6ee7b7 30%, #22c55e 65%, #15803d 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 1.4rem;
      color: #064e3b;
      box-shadow: 0 12px 30px rgba(34, 197, 94, 0.4);
    }

    .user-infos {
      position: relative;
      z-index: 1;
      display: flex;
      flex-direction: column;
      gap: 2px;
      flex: 1;
    }

    .user-name {
      font-size: 1rem;
      font-weight: 600;
    }

    .user-sub {
      font-size: 0.8rem;
      color: var(--text-muted);
    }

    .user-tag {
      margin-top: 4px;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 4px 8px;
      border-radius: var(--radius-pill);
      background: rgba(22, 163, 74, 0.06);
      color: #15803d;
      font-size: 0.72rem;
    }

    .user-tag-dot {
      width: 7px;
      height: 7px;
      border-radius: 999px;
      background: #22c55e;
    }

    .header-actions {
      position: relative;
      z-index: 1;
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      gap: 6px;
    }

    .mini-label {
      padding: 4px 7px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.06);
      font-size: 0.7rem;
    }

    .dropdown {
      width: 30px;
      height: 30px;
      border-radius: 999px;
      border: none;
      background: rgba(15, 23, 42, 0.06);
      display: flex;
      align-items: center;
      justify-content: center;
    }

    /* === MENU BUTTONS === */
    .menu {
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin-top: 2px;
    }

    .menu-btn {
      border-radius: var(--radius-lg);
      background: var(--bg-menu);
      border: 1px solid rgba(148, 163, 184, 0.25);
      padding: 10px 14px;
      font-size: 0.96rem;
      font-weight: 500;
      display: flex;
      align-items: center;
      justify-content: space-between;
      box-shadow: 0 14px 28px rgba(15, 23, 42, 0.08);
    }

    .menu-btn span:last-child {
      font-size: 1.05rem;
      opacity: 0.7;
    }

    /* === PRODUITS === */
    .products {
      margin-top: 4px;
      display: flex;
      flex-direction: column;
      gap: 12px;
      padding-bottom: 12px;
    }

    .product-card {
      border-radius: var(--radius-xl);
      background: var(--bg-product);
      border: 1px solid rgba(209, 213, 219, 0.7);
      padding: 12px 14px 14px;
      box-shadow: 0 18px 40px rgba(148, 163, 184, 0.25);
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .product-image {
      height: 120px;
      border-radius: 18px;
      background: linear-gradient(135deg, #fee2b3, #f97316 40%, #ea580c 85%);
    }

    .product-title-row {
      display: flex;
      align-items: center;
      gap: 6px;
      margin-top: 4px;
    }

    .product-title-row span:first-child {
      font-size: 1.1rem;
    }

    .product-title {
      font-weight: 600;
      font-size: 0.98rem;
    }

    .product-desc {
      font-size: 0.82rem;
      color: var(--text-muted);
    }

    .product-bottom {
      display: flex;
      align-items: flex-end;
      justify-content: space-between;
      margin-top: 2px;
    }

    .product-price {
      font-weight: 700;
      font-size: 1.02rem;
      color: var(--accent-dark);
    }

    .product-btn {
      padding: 8px 14px;
      border-radius: var(--radius-pill);
      border: none;
      background: linear-gradient(135deg, #6ee7b7, #22c55e);
      color: #064e3b;
      font-weight: 600;
      font-size: 0.9rem;
      box-shadow: 0 12px 28px rgba(34, 197, 94, 0.35);
    }

    .product-btn:active {
      transform: translateY(1px);
      box-shadow: 0 4px 14px rgba(34, 197, 94, 0.28);
    }
  </style>
</head>
<body>
  <div class="app">
    <!-- DÃ©cor arbres -->
    <div class="bg-tree">
      <div class="tree-left">
        <div class="tree-trunk"></div>
      </div>
      <div class="tree-right">
        <div class="tree-trunk"></div>
      </div>
    </div>

    <!-- Top bar -->
    <div class="top-bar">
      <button class="close-btn" id="btnCloseTop">
        <span>âœ•</span>
        <span>Fermer</span>
      </button>
      <div class="top-right">
        <span id="timeDisplay">--:--</span>
      </div>
    </div>

    <!-- Header avec avatar -->
    <section class="header-card">
      <div class="avatar" id="avatarInitials">SL</div>
      <div class="user-infos">
        <div class="user-name" id="userName">Mini App Du Lev</div>
        <div class="user-sub" id="userSub">Gestion depuis Telegram</div>
        <div class="user-tag">
          <span class="user-tag-dot"></span>
          <span id="userTagLabel">ConnectÃ©</span>
        </div>
      </div>
      <div class="header-actions">
        <div class="mini-label">Telegram</div>
        <button class="dropdown">â‹¯</button>
      </div>
    </section>

    <!-- Menu boutons -->
    <section class="menu">
      <button class="menu-btn" id="btnMiniApp">
        <span>Mini App Du Lev</span>
        <span>â€º</span>
      </button>
      <button class="menu-btn" id="btnReseaux">
        <span>RÃ©seaux Sociaux</span>
        <span>â€º</span>
      </button>
      <button class="menu-btn" id="btnLivraison">
        <span>Livraison ðŸšš</span>
        <span>â€º</span>
      </button>
    </section>

    <!-- Produits -->
    <section class="products">
      <!-- Produit 1 -->
      <article class="product-card" data-product-id="ecouteurs_bt">
        <div class="product-image"></div>
        <div class="product-title-row">
          <span>ðŸŽ§</span>
          <span class="product-title">Ã‰couteurs Bluetooth</span>
        </div>
        <p class="product-desc">
          Autonomie, basses, rÃ©duction de bruit.
        </p>
        <div class="product-bottom">
          <span class="product-price">34,99 â‚¬</span>
          <button class="product-btn">Commander</button>
        </div>
      </article>

      <!-- Produit 2 -->
      <article class="product-card" data-product-id="powerbank_20k">
        <div class="product-image"></div>
        <div class="product-title-row">
          <span>ðŸ”‹</span>
          <span class="product-title">Powerbank 20 000 mAh</span>
        </div>
        <p class="product-desc">
          Recharge rapide, USB-C & USB-A.
        </p>
        <div class="product-bottom">
          <span class="product-price">49,99 â‚¬</span>
          <button class="product-btn">Commander</button>
        </div>
      </article>
    </section>
  </div>

  <!-- Telegram WebApp SDK -->
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <script>
    const tg = window.Telegram.WebApp;
    tg.expand();

    const initDataUnsafe = tg.initDataUnsafe;
    const user = initDataUnsafe.user || null;

    const avatarInitials = document.getElementById("avatarInitials");
    const userName = document.getElementById("userName");
    const userSub = document.getElementById("userSub");
    const userTagLabel = document.getElementById("userTagLabel");
    const timeDisplay = document.getElementById("timeDisplay");

    // Affichage de l'heure (comme sur ton screen en haut)
    function updateTime() {
      const now = new Date();
      const h = String(now.getHours()).padStart(2, "0");
      const m = String(now.getMinutes()).padStart(2, "0");
      timeDisplay.textContent = `${h}:${m}`;
    }
    updateTime();

    // Init user depuis Telegram
    function initUser() {
      if (!user) {
        avatarInitials.textContent = "SL";
        userName.textContent = "Mini App Du Lev";
        userSub.textContent = "Ouvre depuis Telegram pour voir ton profil.";
        userTagLabel.textContent = "Hors session";
        return;
      }

      const firstName = user.first_name || "";
      const lastName = user.last_name || "";
      const username = user.username || "";

      const initials =
        (firstName[0] || "") + (lastName[0] || firstName[1] || "");
      avatarInitials.textContent = initials.toUpperCase() || "SL";

      userName.textContent = `${firstName} ${lastName}`.trim() || "Utilisateur Telegram";
      userSub.textContent = username ? `@${username}` : "ConnectÃ© via Telegram";
      userTagLabel.textContent = "ConnectÃ©";
    }

    initUser();

    // Fermer (top + bouton close Telegram)
    document.getElementById("btnCloseTop").addEventListener("click", () => {
      tg.close();
    });

    // Menu buttons â€“ Ã  adapter si tu veux envoyer des actions au bot
    document.getElementById("btnMiniApp").addEventListener("click", () => {
      tg.sendData(JSON.stringify({ type: "menu", action: "mini_app" }));
    });

    document.getElementById("btnReseaux").addEventListener("click", () => {
      tg.sendData(JSON.stringify({ type: "menu", action: "reseaux" }));
    });

    document.getElementById("btnLivraison").addEventListener("click", () => {
      tg.sendData(JSON.stringify({ type: "menu", action: "livraison" }));
    });

    // Boutons "Commander"
    document.querySelectorAll(".product-card").forEach((card) => {
      const btn = card.querySelector(".product-btn");
      const productId = card.getAttribute("data-product-id");
      const title = card.querySelector(".product-title").textContent;

      btn.addEventListener("click", () => {
        tg.sendData(
          JSON.stringify({
            type: "order",
            product_id: productId,
            product_title: title,
          })
        );
        tg.showPopup({
          title: "Commande",
          message: `Ta demande pour "${title}" a Ã©tÃ© envoyÃ©e au bot âœ…`,
          buttons: [{ id: "ok", type: "default", text: "OK" }],
        });
      });
    });
  </script>
</body>
</html>
